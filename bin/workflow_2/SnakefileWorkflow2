OUTCOMES = ['total_cases', 'total_deaths']
# read from cl wehtehr to normalize the outcomes by population and YEAR of interest
NORMALIZE = config["normalize"]
YEAR = config["year"]
# gen output names (barplots): 
ALL_BARPLOTS = expand('../../results/barplot_{outcome}_by_continent.png', outcome=OUTCOMES)
if NORMALIZE:
   ALL_BARPLOTS = expand(f'../../results/barplot_{outcome}_norm_by_continent.png', outcome=OUTCOMES)


rule all:
    input:
        '../../data/owid-covid-data_processed.csv',
        '../../data/owid-covid-data_processed_w2.csv',
        ALL_BARPLOTS


rule clean:
    shell: 'rm  ../../results/{*.png,*.txt}  ../../data/{*_processed*.csv,*.tmp}'


rule dataprocessing:
    input:
        cmd='dataprocessing.py',
        csv='../../data/owid-covid-data.csv'
    output: '../../data/owid-covid-data_processed.csv'
    shell: 'python {input.cmd} -i {input.csv} -o {output}'


rule dataprocessing_w2:
    input:
        cmd='dataprocessing_w2.py',
        csv='../../data/owid-covid-data_processed.csv'
    output: '../../data/owid-covid-data_processed_w2.csv'
    shell: 'python {input.cmd} -i {input.csv} -o {output} -n {NORMALIZE}'


rule plotdeathscases:
    input:
        cmd='plotdeathscases_w2.py',
        csv='../../data/owid-covid-data_processed_w2.csv'
    output: expand('../../results/barplot_{outcome}_norm_by_continent.png', outcome=OUTCOMES) if NORMALIZE else expand('../../results/barplot_{outcome}_by_continent.png', outcome=OUTCOMES)
    shell: 'python {input.cmd} -i {input.csv} -o {output} --outcome {wildcards.outcome} --YEAR {YEAR}'